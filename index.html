<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Desafio Matemágico</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; margin:0; overflow:hidden; color:#fff; }
canvas { position:absolute; top:0; left:0; width:100%; height:100%; z-index:0; }
.window { position: absolute; top:50%; left:50%; transform: translate(-50%,-50%); z-index:1; width: 650px; background: rgba(255,255,255,0.95); color: #2d3436; border-radius: 16px; box-shadow: 0 15px 35px rgba(0,0,0,0.4); overflow: hidden; padding-bottom: 20px; transition: width 0.5s, padding 0.5s; }
.window.game-active { width: 90%; max-width: 900px; padding: 40px 30px; }
.title-bar { background: linear-gradient(90deg, #6c5ce7, #00b894); color: #fff; padding: 14px; font-weight: 700; font-size: 18px; text-align: center; letter-spacing: 1px; }
.content { padding: 25px; text-align: center; }
h2 { margin: 10px 0; font-size: 28px; font-weight: 700; color: #6c5ce7; text-shadow: 2px 2px 8px rgba(0,0,0,0.4); }
p { margin: 6px 0 16px 0; font-size: 18px; font-weight: 500; color: #00b894; text-shadow: 1px 1px 4px rgba(0,0,0,0.3); }
#requiredName { font-size: 16px; font-weight: 700; color: #e84393; text-shadow: 1px 1px 4px rgba(0,0,0,0.3); display: block; margin-bottom: 15px; }
input[type='number'], input[type='text'] { font-size: 18px; font-weight: 500; border: 2px solid #6c5ce7; padding: 12px; border-radius: 10px; width: 70%; margin-bottom: 12px; transition: 0.3s; }
input:focus { outline: none; border-color: #00cec9; box-shadow: 0 0 10px #00cec9; }
button { background: #6c5ce7; border: none; color: #fff; padding: 14px 28px; border-radius: 10px; cursor: pointer; font-weight: 600; margin: 12px 6px; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.25); font-size: 18px; }
button:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
#timer { display: inline-block; background: #6c5ce7; color: #fff; padding: 8px 20px; border-radius: 16px; font-weight: 700; font-size: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: background 0.3s; }
#feedback { font-weight: 700; margin-top: 12px; font-size: 20px; text-shadow: 1px 1px 4px rgba(0,0,0,0.5); }
#question { border: 3px solid #000; border-radius: 12px; padding: 12px 20px; display: inline-block; background: #fff; color: #000; font-size: 28px; font-weight: 700; min-width: 250px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #b2bec3; padding: 8px; font-size: 16px; text-align: center; }
th { background: #6c5ce7; color: #fff; font-size: 16px; }
tbody tr:nth-child(1) { background: #ffd700; font-weight: bold; }
tbody tr:nth-child(2) { background: #c0c0c0; font-weight: bold; }
tbody tr:nth-child(3) { background: #cd7f32; font-weight: bold; }
.difficulty-buttons { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 15px; }
.difficulty-buttons button { flex: 1 1 120px; max-width: 140px; }
#game, #endScreen, #ranking { display: none; }
#invisibleResetBtn { position: absolute; top: 10px; right: 10px; width: 20px; height: 20px; background: transparent; border: none; opacity: 0.05; cursor: pointer; z-index: 10; }
#invisibleResetBtn:hover { opacity: 0.2; }
</style>
</head>
<body>
<canvas id="mathCanvas"></canvas>
<div class="window" id="mainWindow">
<div class="title-bar">Desafio Matemágico</div>

<div class="content" id="startScreen">
<h2>Bem-vindo ao Desafio Matemágico!</h2>
<p>Digite seu nome e escolha a dificuldade:</p>
<input type="text" id="playerNameStart" placeholder="Seu nome aqui"><br>
<span id="requiredName">* Nome obrigatório!</span>
<div class="difficulty-buttons">
<button onclick="startGame('facil')">Fácil</button>
<button onclick="startGame('medio')">Médio</button>
<button onclick="startGame('dificil')">Difícil</button>
<button onclick="startGame('impossivel')">Impossível</button>
</div>
<button onclick="showRanking()">Ver Ranking</button>
</div>

<div class="content" id="game">
<h2 id="question">Pergunta aqui</h2>
<input type="number" id="answer" placeholder="Sua resposta"><br>
<button onclick="checkAnswer()">Responder</button>
<button onclick="skipQuestion()">Pular Pergunta</button>
<p>Pontuação: <span id="score">0</span></p>
<p>Tempo restante: <span id="timer">60</span>s</p>
<p id="feedback"></p>
<button onclick="backToStartFromGame()">Voltar ao Início</button>
</div>

<div class="content" id="endScreen">
<h2>Fim de jogo!</h2>
<p>Sua pontuação: <span id="finalScore"></span></p>
<button onclick="saveScore()">Salvar Pontuação</button>
<button onclick="showRanking()">Ver Ranking</button>
<button onclick="restartGame()">Jogar Novamente</button>
</div>

<div class="content" id="ranking">
<h2>Ranking</h2>
<table>
<thead><tr><th>Jogador</th><th>Pontuação</th><th>Dificuldade</th></tr></thead>
<tbody id="rankingTable"></tbody>
</table>
<button onclick="backToStart()">Voltar</button>
<button onclick="resetRanking()" id="invisibleResetBtn" title="Reset Ranking"></button>
</div>
</div>

<script>
// Fundo estilo caderno
const canvas = document.getElementById('mathCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight;
let isDrawing=false, lastX=0, lastY=0;

function drawNotebookBackground() {
  ctx.fillStyle='#fff8dc';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle='#dcdcdc';
  ctx.lineWidth=1;
  for(let y=40;y<canvas.height;y+=40){
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
  }
}
drawNotebookBackground();
window.addEventListener('resize',()=>{ canvas.width=window.innerWidth; canvas.height=window.innerHeight; drawNotebookBackground(); });

canvas.addEventListener('mousedown',e=>{ isDrawing=true; lastX=e.offsetX; lastY=e.offsetY; });
canvas.addEventListener('mousemove',e=>{ if(!isDrawing) return; ctx.strokeStyle='#000'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke(); lastX=e.offsetX; lastY=e.offsetY; });
canvas.addEventListener('mouseup',()=>isDrawing=false);
canvas.addEventListener('mouseout',()=>isDrawing=false);
canvas.addEventListener('contextmenu', e=>{ e.preventDefault(); drawNotebookBackground(); });

// Game logic
let score=0, currentAnswer=0, difficulty='facil', timer=60, timerInterval=0;
const questionsFacil=[
  {q:"2+3",a:5},{q:"4-1",a:3},{q:"5+5",a:10},{q:"6-2",a:4},{q:"3+7",a:10},
  {q:"7+8",a:15},{q:"9-5",a:4},{q:"10-3",a:7},{q:"6+9",a:15},{q:"12-7",a:5},
  {q:"2*2",a:4},{q:"3*3",a:9},{q:"4*2",a:8},{q:"5*2",a:10},{q:"2*6",a:12},
  {q:"1+9",a:10},{q:"8-3",a:5},{q:"7+5",a:12},{q:"6+8",a:14},{q:"10-6",a:4},
  {q:"3*4",a:12},{q:"2*7",a:14},{q:"5+9",a:14},{q:"4+6",a:10},{q:"8-2",a:6},
  {q:"6*2",a:12},{q:"1+8",a:9},{q:"7+3",a:10},{q:"5+7",a:12},{q:"9-4",a:5}
];
const questionsMedio=[{q:"12+15",a:27},{q:"18-7",a:11},{q:"5*6",a:30},{q:"20/4",a:5},{q:"7*8",a:56}];
const questionsDificil=[{q:"25*4",a:100},{q:"144/12",a:12},{q:"15*12",a:180},{q:"60/5",a:12},{q:"11*11",a:121}];
const questionsImpossivel=[{q:"123+456",a:579},{q:"789-321",a:468},{q:"25*36",a:900},{q:"1024/8",a:128},{q:"11*12+5",a:137}];
let currentQuestions=[];

function startGame(level){
  let playerName=document.getElementById("playerNameStart").value.trim();
  if(!playerName){ alert("Digite seu nome!"); return; }
  difficulty=level; score=0; timer=60;
  document.getElementById("score").innerText=score;
  document.getElementById("timer").innerText=timer;
  document.getElementById("startScreen").style.display="none";
  document.getElementById("game").style.display="block";
  document.getElementById("mainWindow").classList.add("game-active");

  currentQuestions=difficulty==="facil"?questionsFacil: difficulty==="medio"?questionsMedio: difficulty==="dificil"?questionsDificil:questionsImpossivel;
  generateQuestion();
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{ timer--; document.getElementById("timer").innerText=timer; if(timer<=0) endGame(); },1000);
}

function generateQuestion(){ let q=currentQuestions[Math.floor(Math.random()*currentQuestions.length)]; currentAnswer=q.a; document.getElementById("question").innerText=q.q; document.getElementById("feedback").innerText=""; }

function checkAnswer(){
  let userAnswer=parseFloat(document.getElementById("answer").value); if(isNaN(userAnswer)) return;
  const feedbackEl=document.getElementById("feedback");
  if(Math.abs(userAnswer-currentAnswer)<0.01){ feedbackEl.style.color="#00ff00"; feedbackEl.innerText="✔ Correto!"; score+=10; document.getElementById("score").innerText=score; } 
  else { feedbackEl.style.color="#ff3333"; feedbackEl.innerText=`✖ Errado! Resposta correta: ${currentAnswer}`; }
  document.getElementById("answer").value="";
  generateQuestion();
}

function skipQuestion(){ generateQuestion(); document.getElementById("feedback").style.color="#f1c40f"; document.getElementById("feedback").innerText="➔ Pergunta pulada"; }

function saveScore(){
  let playerName=document.getElementById("playerNameStart").value.trim()||"Anônimo";
  let scores=JSON.parse(localStorage.getItem("ranking"))||[];
  const existing=scores.find(s=>s.name===playerName);
  if(existing){ existing.score=Math.max(existing.score,score); existing.diff=difficulty; } 
  else { scores.push({name:playerName,score:score,diff:difficulty}); }
  scores.sort((a,b)=>b.score-a.score);
  localStorage.setItem("ranking",JSON.stringify(scores));
  showRanking();
}

function showRanking(){
  document.getElementById("startScreen").style.display="none";
  document.getElementById("endScreen").style.display="none";
  document.getElementById("game").style.display="none";
  document.getElementById("ranking").style.display="block";
  const scores=JSON.parse(localStorage.getItem("ranking"))||[];
  let table=""; scores.forEach(s=>{ table+=`<tr><td>${s.name}</td><td>${s.score}</td><td>${s.diff}</td></tr>`; });
  document.getElementById("rankingTable").innerHTML=table;
}

function resetRanking(){ localStorage.removeItem('ranking'); document.getElementById("rankingTable").innerHTML=""; alert("Ranking resetado!"); }

function backToStart(){ document.getElementById("ranking").style.display="none"; document.getElementById("startScreen").style.display="block"; }

function backToStartFromGame(){ clearInterval(timerInterval); document.getElementById("game").style.display="none"; document.getElementById("startScreen").style.display="block"; document.getElementById("mainWindow").classList.remove("game-active"); }

function restartGame(){ document.getElementById("endScreen").style.display="none"; document.getElementById("startScreen").style.display="block"; }

function endGame(){ clearInterval(timerInterval); document.getElementById("game").style.display="none"; document.getElementById("endScreen").style.display="block"; document.getElementById("finalScore").innerText=score; }

document.getElementById("answer").addEventListener("keydown", e=>{ if(e.key==="Enter") checkAnswer(); });
</script>
</body>
</html>
